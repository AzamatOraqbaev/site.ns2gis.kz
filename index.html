<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caff√® Musetti | –ú–µ–Ω—é</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ */
        /* ... (–≤—Å—Ç–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –í–°–ï —Å—Ç–∏–ª–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ index.html) ... */
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Caff√® Musetti</h1>
                    <div class="subtitle">ITALIAN COFFEE EXPERIENCE</div>
                </div>
                
                <div class="nav-container">
                    <div class="nav-arrow left">‚Äπ</div>
                    <nav id="main-nav">
                        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
                    </nav>
                    <div class="nav-arrow right">‚Ä∫</div>
                </div>

                <a href="admin.html" class="admin-link">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            </div>
        </div>
    </header>

    <div class="breakfast-highlight">
        üç≥ –ó–∞–≤—Ç—Ä–∞–∫–∏ –ø–æ–¥–∞—é—Ç—Å—è —Å 8:00 –¥–æ 12:00
    </div>

    <button class="floating-cart-btn" id="floating-cart-btn">
        <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        <span class="cart-badge" id="cart-badge">0</span>
    </button>

    <div class="cart-modal" id="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-header">
                <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>
                <button class="close-cart" id="close-cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items">
                <div class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            </div>
            <div class="cart-total-modal" id="cart-total-modal">–ò—Ç–æ–≥–æ: 0 ‚Ç∏</div>
            <button class="checkout-btn-modal">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>

    <main class="container" id="menu-container">
        <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...</div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <h3>Caff√® Musetti</h3>
                <p class="contact-info">–≥. –¢–∞—Ä–∞–∑, –£–ª–∏—Ü–∞ –ê–π—Ç–µ–∫–µ –±–∏, 9, 1 —ç—Ç–∞–∂</p>
                <p class="contact-info">+7 (7262) 45‚Äí44‚Äí44</p>
                <p class="contact-info">+7‚Äí700‚Äí760‚Äí50‚Äí96</p>
                <div class="hours">
                    <p>–ü–Ω ‚Äî –ß—Ç: 08:00‚Äì24:00</p>
                    <p>–ü—è—Ç–Ω–∏—Ü–∞: 08:00‚Äì01:00</p>
                    <p>–°—É–±–±–æ—Ç–∞: 09:00‚Äì01:00</p>
                    <p>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 09:00‚Äì24:00</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        class MenuDisplay {
            constructor() {
                this.menuData = {};
                this.categories = {};
                this.init();
            }

            async init() {
                await this.loadData();
                this.renderNavigation();
                this.renderMenu();
            }

            async loadData() {
                try {
                    const response = await fetch('api/get-menu.php');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.menuData = data.menu || {};
                        this.categories = data.categories || {};
                        console.log('Menu data loaded successfully');
                    } else {
                        throw new Error(data.error || 'Failed to load menu');
                    }
                } catch (error) {
                    console.error('Error loading menu data:', error);
                    // Fallback to localStorage
                    try {
                        const savedMenu = localStorage.getItem('musetti-menu');
                        const savedCategories = localStorage.getItem('musetti-categories');
                        
                        this.menuData = savedMenu ? JSON.parse(savedMenu) : {};
                        this.categories = savedCategories ? JSON.parse(savedCategories) : {};
                    } catch (e) {
                        console.error('Fallback also failed:', e);
                    }
                }
            }

            renderNavigation() {
                const nav = document.getElementById('main-nav');
                let html = '';
                let hasCategories = false;

                Object.entries(this.categories).forEach(([id, category]) => {
                    const items = this.menuData[id];
                    if (items && items.length > 0) {
                        hasCategories = true;
                        const isActive = id === Object.keys(this.categories)[0] ? 'active' : '';
                        html += `<a href="#${id}" class="${isActive}">${category.name}</a>`;
                    }
                });

                if (!hasCategories) {
                    html = '<a href="#demo" class="active">–ú–µ–Ω—é</a>';
                }

                nav.innerHTML = html;
                this.bindNavigationEvents();
            }

            bindNavigationEvents() {
                document.querySelectorAll('nav a').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 140,
                                behavior: 'smooth'
                            });
                            
                            document.querySelectorAll('nav a').forEach(link => {
                                link.classList.remove('active');
                            });
                            this.classList.add('active');
                        }
                    });
                });
            }

            renderMenu() {
                const container = document.getElementById('menu-container');
                let html = '';
                let hasItems = false;

                Object.entries(this.categories).forEach(([categoryId, category]) => {
                    const items = this.menuData[categoryId];
                    if (items && items.length > 0) {
                        hasItems = true;
                        html += `
                            <section id="${categoryId}" class="menu-category">
                                <h2>${category.name.toUpperCase()}</h2>
                                <div class="menu-items">
                                    ${items.map(item => `
                                        <div class="menu-item">
                                            <div class="menu-item-image" style="${item.image ? `background-image: url('${item.image}')` : ''}">
                                                ${!item.image ? (category.emoji || 'üçΩÔ∏è') : ''}
                                            </div>
                                            <div class="menu-details">
                                                <h3>${item.name}</h3>
                                                <div class="description">${item.description}</div>
                                                <div class="item-footer">
                                                    <div class="price">${item.price.toLocaleString()} ‚Ç∏</div>
                                                    <button class="add-btn" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </section>
                        `;
                    }
                });

                if (!hasItems) {
                    html = `
                        <section id="demo" class="menu-category">
                            <h2>–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í CAFF√à MUSETTI</h2>
                            <div class="menu-items">
                                <div class="menu-item">
                                    <div class="menu-item-image">‚òï</div>
                                    <div class="menu-details">
                                        <h3>–ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è</h3>
                                        <div class="description">–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                                        <div class="item-footer">
                                            <div class="price"></div>
                                            <a href="admin.html" class="add-btn" style="text-decoration: none;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                }

                container.innerHTML = html;
            }
        }

        // –ö–ª–∞—Å—Å Cart –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
        class Cart {
            // ... (–≤—Å—Ç–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –í–ï–°–¨ –∫–æ–¥ –∫–ª–∞—Å—Å–∞ Cart –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ index.html) ...
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const menuDisplay = new MenuDisplay();
        const cart = new Cart();

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ... (–≤—Å—Ç–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω–æ–π JavaScript –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ index.html) ...
    </script>
</body>
</html>